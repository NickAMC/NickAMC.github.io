<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nick Climaco">
<meta name="dcterms.date" content="2024-05-19">

<title>Predicting Wine Sales Based on Chemical Properties</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="hw4_files/libs/clipboard/clipboard.min.js"></script>
<script src="hw4_files/libs/quarto-html/quarto.js"></script>
<script src="hw4_files/libs/quarto-html/popper.min.js"></script>
<script src="hw4_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="hw4_files/libs/quarto-html/anchor.min.js"></script>
<link href="hw4_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="hw4_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="hw4_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="hw4_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="hw4_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#overview-essay" id="toc-overview-essay" class="nav-link active" data-scroll-target="#overview-essay">Overview (Essay)</a></li>
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation">Implementation</a>
  <ul class="collapse">
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">Exploratory Data Analysis</a>
  <ul class="collapse">
  <li><a href="#missingness" id="toc-missingness" class="nav-link" data-scroll-target="#missingness">Missingness</a></li>
  <li><a href="#boxplots" id="toc-boxplots" class="nav-link" data-scroll-target="#boxplots">Boxplots</a></li>
  <li><a href="#data-distribution" id="toc-data-distribution" class="nav-link" data-scroll-target="#data-distribution">Data Distribution</a></li>
  <li><a href="#correlation-matrix" id="toc-correlation-matrix" class="nav-link" data-scroll-target="#correlation-matrix">Correlation Matrix</a></li>
  </ul></li>
  <li><a href="#data-preprocessing" id="toc-data-preprocessing" class="nav-link" data-scroll-target="#data-preprocessing">Data Preprocessing</a>
  <ul class="collapse">
  <li><a href="#handle-missingness" id="toc-handle-missingness" class="nav-link" data-scroll-target="#handle-missingness">Handle Missingness</a></li>
  <li><a href="#standard-scale" id="toc-standard-scale" class="nav-link" data-scroll-target="#standard-scale">Standard Scale</a></li>
  </ul></li>
  <li><a href="#model-building" id="toc-model-building" class="nav-link" data-scroll-target="#model-building">Model Building</a>
  <ul class="collapse">
  <li><a href="#support-vector-machine" id="toc-support-vector-machine" class="nav-link" data-scroll-target="#support-vector-machine">Support Vector Machine</a></li>
  <li><a href="#random-forest" id="toc-random-forest" class="nav-link" data-scroll-target="#random-forest">Random Forest</a></li>
  <li><a href="#xgboost" id="toc-xgboost" class="nav-link" data-scroll-target="#xgboost">XGBoost</a></li>
  <li><a href="#simple-neural-network" id="toc-simple-neural-network" class="nav-link" data-scroll-target="#simple-neural-network">Simple Neural Network</a></li>
  </ul></li>
  <li><a href="#model-evaluation-and-selection" id="toc-model-evaluation-and-selection" class="nav-link" data-scroll-target="#model-evaluation-and-selection">Model Evaluation and Selection</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Predicting Wine Sales Based on Chemical Properties</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Nick Climaco </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 19, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="overview-essay" class="level1">
<h1>Overview (Essay)</h1>
<p>In this analysis, we aim to predict the number of wine cases sold, labeled as out <code>TARGET</code> variable, using different properties of the wine such as acidity, sugar levels, and other chemical properties in wine. By using machine learning algorithms, we want to identify the leading indicators that impact wine sales and accuractely forecast wine cases sold. This dataset has 12795 obersvations and 15 columns: 14 features and 1 target variable.</p>
<p>We began our analysis by exploring and processing the dataset. Initially, we loaded the dataset from its csv file and examined its shape, paying close attention to any missing values and outliers. We found that several features had significant missing values, including <code>ResidualSugar</code>, <code>Chlorides</code>, <code>FreeSulfurDioxide</code>, <code>TotalSulfurDioxide</code> and <code>Sulphate</code>. To handle the missing values, we used different imputation methods. For <code>ResidualSugar</code>, <code>Chlorides</code>, <code>FreeSulfurDioxide</code>, <code>TotalSulfurDioxide</code>, and <code>Sulphates</code> columns, we used the zero imputation where we filled NA values with zeroes because during the EDA process we found that the distributions of these features had a mean of near zero which told us that using zero imputation would minimize the impact of the imputation. Similar process was used for the columns, where for <code>pH</code> and <code>Alcohol</code>, we applied a median imputaion due to the skewness of their distribution. Lastly, mode imputation was used for the <code>STARS</code> rating because it is a categorical feature. Moveover, we did consider removing <code>STARS</code> due to its high percentage of miss ngnes but it resulted in our models performing worse thus we kept and applied imputation instead. After all of the imputations, we then moved on to standardizing the data to ensure all of the features were on the same scale, which can impact the performance of some ML algorithms that are sensitive to feature scaling.</p>
<p>Next, we conducted more EDA to discover and better understand the data. This EDA including creating boxplots and histograms to visualize the distributions and possible outliers and generated a correlation matrix in order to identify the relationships between feature. The boxplot was helful in displaying the variability and outliers. The correlation matrix indicated that the feature a mainly independent of each other. After the EDA, we proceeded with data preprocessing, which involved splitting the dataset into training and testing sets with a 75-25 split. This split allowed us to train our models on a portion of the data while keeping a separate set for evaluating the models’ performance. We implemented several models to predict the <code>TARGET</code> variable, including the Support Vector Machine (SVR), Random Forest Regressor, XGBooost Regressor, and a Simple Neural Network. We wanted to use models that differ in approah. The SVR uses a hyperplane to separate data points where it relies on the anchor points to make the decision so we were not concern with outliers in this case. The random forest regressor approach of the bagging techniques to create an ensemble of decision trees. If we use the bagged method, then we also want to use boosting here we used XGBoost. Lasly, the simple neural network leverages deep learning capabilities for this regression task.</p>
<p>To optimize the perfomance of each model, we utilized GridSearchCV for hyperparameter tuning. For the Support Vector Machine, we tuned the kernel, C, and epsilon parameters. The Random Forest model’s hyperparameters included the number of estimators, max depth, min samples split, and min samples leaf. XGBoost’s parameters included the number of estimators, max depth, learning rate, subsample, colsample_bytree, gamma, reg_alpha, and reg_lambda. For the Simple Neural Network, we adjusted the number of layers, the number of neurons in each layer, and the dropout rate.</p>
<p>After tuning the models, we evaluated them using Mean Squared Error (MSE), Root Mean Squared Error (RMSE), and Mean Absolute Error (MAE). We used these evaluation metrics to measure how well each model performed on the testing data. The Support Vector Machine got an MSE of 2.658, an RMSE of 1.630, and an MAE of 1.208. The Random Forest model performed slightly better with an MSE of 2.281, an RMSE of 1.510, and an MAE of 1.181. XGBoost outperformed both with an MSE of 2.217, an RMSE of 1.489, and an MAE of 1.166. The Simple Neural Network got an MSE of 2.514, an RMSE of 1.585, and an MAE of 1.234. From this, we found that XGBoost was our best performing model. Beforehand, we expected to the neural network to outperform the other model but to our surprise it the worse performing. We suspect that this may be due to the lack of thorough hypertuning. We did try a number of different epochs with 200 being the best out of the manual trials. Moreover, we didnt want to increase the epochs drastically since it increases the risk of overfitting.</p>
<p>From our analysis, we found that <code>STARS</code>, <code>LabelAppeal</code>, and <code>AcidIndex</code> are the most influencial features to wine sales. These features consistently emerged as the most significant predictors in our models. By focusing on these variables, we can better understand what drives wine sales and develop strategies to enhance them. Evidently, customers heavily depend on the wine’s star rating reviews. In order to increase sales, we suggest improvement our wines overall star rating meaning the higher the star rating a wine is given the more wine cases are sold. Another significant feature was the wine label, thus we suggest focusing on the design of the label to attract more customers.</p>
<p>In conclusion, this analysis has shown that properly preprocessing the data, we can build predictive models for study the forecast of wine sales. Our findings on the feature importance of <code>STARS</code>. <code>LabelAppeal</code> and <code>AcidIndex</code> are leading indicators to actionable improvements for the production and marketing teams to improve the companies overall wine sales.</p>
</section>
<section id="implementation" class="level1">
<h1>Implementation</h1>
<section id="exploratory-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis">Exploratory Data Analysis</h2>
<div id="cell-4" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> numpy <span class="im">as</span> np </span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="im">import</span> seaborn <span class="im">as</span> sns </span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV, train_test_split</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVR</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, mean_absolute_error, r2_score</span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="im">from</span> xgboost <span class="im">import</span> XGBRegressor</span>
<span id="cb1-12"><a href="#cb1-12"></a></span>
<span id="cb1-13"><a href="#cb1-13"></a>plt.rcParams[<span class="st">'figure.figsize'</span>] <span class="op">=</span> (<span class="dv">10</span>, <span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-5" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a>data <span class="op">=</span> pd.read_csv(<span class="st">'wine-training-data.csv'</span>).drop(<span class="st">'INDEX'</span>, axis <span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb2-2"><a href="#cb2-2"></a>data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">TARGET</th>
<th data-quarto-table-cell-role="th">FixedAcidity</th>
<th data-quarto-table-cell-role="th">VolatileAcidity</th>
<th data-quarto-table-cell-role="th">CitricAcid</th>
<th data-quarto-table-cell-role="th">ResidualSugar</th>
<th data-quarto-table-cell-role="th">Chlorides</th>
<th data-quarto-table-cell-role="th">FreeSulfurDioxide</th>
<th data-quarto-table-cell-role="th">TotalSulfurDioxide</th>
<th data-quarto-table-cell-role="th">Density</th>
<th data-quarto-table-cell-role="th">pH</th>
<th data-quarto-table-cell-role="th">Sulphates</th>
<th data-quarto-table-cell-role="th">Alcohol</th>
<th data-quarto-table-cell-role="th">LabelAppeal</th>
<th data-quarto-table-cell-role="th">AcidIndex</th>
<th data-quarto-table-cell-role="th">STARS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>3</td>
<td>3.2</td>
<td>1.160</td>
<td>-0.98</td>
<td>54.2</td>
<td>-0.567</td>
<td>NaN</td>
<td>268.0</td>
<td>0.99280</td>
<td>3.33</td>
<td>-0.59</td>
<td>9.9</td>
<td>0</td>
<td>8</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>3</td>
<td>4.5</td>
<td>0.160</td>
<td>-0.81</td>
<td>26.1</td>
<td>-0.425</td>
<td>15.0</td>
<td>-327.0</td>
<td>1.02792</td>
<td>3.38</td>
<td>0.70</td>
<td>NaN</td>
<td>-1</td>
<td>7</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>5</td>
<td>7.1</td>
<td>2.640</td>
<td>-0.88</td>
<td>14.8</td>
<td>0.037</td>
<td>214.0</td>
<td>142.0</td>
<td>0.99518</td>
<td>3.12</td>
<td>0.48</td>
<td>22.0</td>
<td>-1</td>
<td>8</td>
<td>3.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>3</td>
<td>5.7</td>
<td>0.385</td>
<td>0.04</td>
<td>18.8</td>
<td>-0.425</td>
<td>22.0</td>
<td>115.0</td>
<td>0.99640</td>
<td>2.24</td>
<td>1.83</td>
<td>6.2</td>
<td>-1</td>
<td>6</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>4</td>
<td>8.0</td>
<td>0.330</td>
<td>-1.26</td>
<td>9.4</td>
<td>NaN</td>
<td>-167.0</td>
<td>108.0</td>
<td>0.99457</td>
<td>3.12</td>
<td>1.77</td>
<td>13.7</td>
<td>0</td>
<td>9</td>
<td>2.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-6" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a>X <span class="op">=</span> data.drop(<span class="st">'TARGET'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a>y <span class="op">=</span> data[[<span class="st">'TARGET'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-7" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a>data.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 12795 entries, 0 to 12794
Data columns (total 15 columns):
 #   Column              Non-Null Count  Dtype  
---  ------              --------------  -----  
 0   TARGET              12795 non-null  int64  
 1   FixedAcidity        12795 non-null  float64
 2   VolatileAcidity     12795 non-null  float64
 3   CitricAcid          12795 non-null  float64
 4   ResidualSugar       12179 non-null  float64
 5   Chlorides           12157 non-null  float64
 6   FreeSulfurDioxide   12148 non-null  float64
 7   TotalSulfurDioxide  12113 non-null  float64
 8   Density             12795 non-null  float64
 9   pH                  12400 non-null  float64
 10  Sulphates           11585 non-null  float64
 11  Alcohol             12142 non-null  float64
 12  LabelAppeal         12795 non-null  int64  
 13  AcidIndex           12795 non-null  int64  
 14  STARS               9436 non-null   float64
dtypes: float64(12), int64(3)
memory usage: 1.5 MB</code></pre>
</div>
</div>
<div id="cell-8" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a>data.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="70">
<pre><code>(12795, 15)</code></pre>
</div>
</div>
<div id="cell-9" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a>data.describe().T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">TARGET</td>
<td>12795.0</td>
<td>3.029074</td>
<td>1.926368</td>
<td>0.00000</td>
<td>2.00000</td>
<td>3.00000</td>
<td>4.000000</td>
<td>8.00000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">FixedAcidity</td>
<td>12795.0</td>
<td>7.075717</td>
<td>6.317643</td>
<td>-18.10000</td>
<td>5.20000</td>
<td>6.90000</td>
<td>9.500000</td>
<td>34.40000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">VolatileAcidity</td>
<td>12795.0</td>
<td>0.324104</td>
<td>0.784014</td>
<td>-2.79000</td>
<td>0.13000</td>
<td>0.28000</td>
<td>0.640000</td>
<td>3.68000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">CitricAcid</td>
<td>12795.0</td>
<td>0.308413</td>
<td>0.862080</td>
<td>-3.24000</td>
<td>0.03000</td>
<td>0.31000</td>
<td>0.580000</td>
<td>3.86000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ResidualSugar</td>
<td>12179.0</td>
<td>5.418733</td>
<td>33.749379</td>
<td>-127.80000</td>
<td>-2.00000</td>
<td>3.90000</td>
<td>15.900000</td>
<td>141.15000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Chlorides</td>
<td>12157.0</td>
<td>0.054822</td>
<td>0.318467</td>
<td>-1.17100</td>
<td>-0.03100</td>
<td>0.04600</td>
<td>0.153000</td>
<td>1.35100</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">FreeSulfurDioxide</td>
<td>12148.0</td>
<td>30.845571</td>
<td>148.714558</td>
<td>-555.00000</td>
<td>0.00000</td>
<td>30.00000</td>
<td>70.000000</td>
<td>623.00000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">TotalSulfurDioxide</td>
<td>12113.0</td>
<td>120.714233</td>
<td>231.913211</td>
<td>-823.00000</td>
<td>27.00000</td>
<td>123.00000</td>
<td>208.000000</td>
<td>1057.00000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Density</td>
<td>12795.0</td>
<td>0.994203</td>
<td>0.026538</td>
<td>0.88809</td>
<td>0.98772</td>
<td>0.99449</td>
<td>1.000515</td>
<td>1.09924</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">pH</td>
<td>12400.0</td>
<td>3.207628</td>
<td>0.679687</td>
<td>0.48000</td>
<td>2.96000</td>
<td>3.20000</td>
<td>3.470000</td>
<td>6.13000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Sulphates</td>
<td>11585.0</td>
<td>0.527112</td>
<td>0.932129</td>
<td>-3.13000</td>
<td>0.28000</td>
<td>0.50000</td>
<td>0.860000</td>
<td>4.24000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Alcohol</td>
<td>12142.0</td>
<td>10.489236</td>
<td>3.727819</td>
<td>-4.70000</td>
<td>9.00000</td>
<td>10.40000</td>
<td>12.400000</td>
<td>26.50000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">LabelAppeal</td>
<td>12795.0</td>
<td>-0.009066</td>
<td>0.891089</td>
<td>-2.00000</td>
<td>-1.00000</td>
<td>0.00000</td>
<td>1.000000</td>
<td>2.00000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">AcidIndex</td>
<td>12795.0</td>
<td>7.772724</td>
<td>1.323926</td>
<td>4.00000</td>
<td>7.00000</td>
<td>8.00000</td>
<td>8.000000</td>
<td>17.00000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">STARS</td>
<td>9436.0</td>
<td>2.041755</td>
<td>0.902540</td>
<td>1.00000</td>
<td>1.00000</td>
<td>2.00000</td>
<td>3.000000</td>
<td>4.00000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="missingness" class="level3">
<h3 class="anchored" data-anchor-id="missingness">Missingness</h3>
<div id="cell-11" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a>data.isna().<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">True</span>).plot(kind<span class="op">=</span><span class="st">'barh'</span>)</span>
<span id="cb9-2"><a href="#cb9-2"></a>plt.title(<span class="st">'Missing values count per feature'</span>)</span>
<span id="cb9-3"><a href="#cb9-3"></a>plt.xlabel(<span class="st">'count'</span>)</span>
<span id="cb9-4"><a href="#cb9-4"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="hw4_files/figure-html/cell-8-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="boxplots" class="level3">
<h3 class="anchored" data-anchor-id="boxplots">Boxplots</h3>
<div id="cell-13" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="cf">for</span> i, column <span class="kw">in</span> <span class="bu">enumerate</span>(X, <span class="dv">1</span>):</span>
<span id="cb10-2"><a href="#cb10-2"></a>    plt.subplot(<span class="dv">4</span>, <span class="dv">4</span>, i)</span>
<span id="cb10-3"><a href="#cb10-3"></a>    sns.boxplot(y<span class="op">=</span>X[column])</span>
<span id="cb10-4"><a href="#cb10-4"></a>    plt.title(<span class="ss">f'Box Plot of </span><span class="sc">{</span>column<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb10-5"><a href="#cb10-5"></a>plt.tight_layout()</span>
<span id="cb10-6"><a href="#cb10-6"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="hw4_files/figure-html/cell-9-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="data-distribution" class="level3">
<h3 class="anchored" data-anchor-id="data-distribution">Data Distribution</h3>
</section>
<section id="correlation-matrix" class="level3">
<h3 class="anchored" data-anchor-id="correlation-matrix">Correlation Matrix</h3>
<div id="cell-17" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a>correlation_matrix <span class="op">=</span> X.corr()</span>
<span id="cb11-2"><a href="#cb11-2"></a></span>
<span id="cb11-3"><a href="#cb11-3"></a>sns.heatmap(correlation_matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">".2f"</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb11-4"><a href="#cb11-4"></a>plt.title(<span class="st">'Correlation Matrix'</span>)</span>
<span id="cb11-5"><a href="#cb11-5"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="hw4_files/figure-html/cell-11-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="data-preprocessing" class="level2">
<h2 class="anchored" data-anchor-id="data-preprocessing">Data Preprocessing</h2>
<section id="handle-missingness" class="level3">
<h3 class="anchored" data-anchor-id="handle-missingness">Handle Missingness</h3>
<div id="cell-20" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a>X.isna().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="75">
<pre><code>FixedAcidity             0
VolatileAcidity          0
CitricAcid               0
ResidualSugar          616
Chlorides              638
FreeSulfurDioxide      647
TotalSulfurDioxide     682
Density                  0
pH                     395
Sulphates             1210
Alcohol                653
LabelAppeal              0
AcidIndex                0
STARS                 3359
dtype: int64</code></pre>
</div>
</div>
<div id="cell-21" class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># impute with zero</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>zero_cols <span class="op">=</span> [<span class="st">'ResidualSugar'</span>, <span class="st">'Chlorides'</span>, <span class="st">'FreeSulfurDioxide'</span>, <span class="st">'TotalSulfurDioxide'</span>, <span class="st">'Sulphates'</span>]</span>
<span id="cb14-3"><a href="#cb14-3"></a></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="co"># impute with median</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>median_cols <span class="op">=</span> [<span class="st">'pH'</span>, <span class="st">'Alcohol'</span>]</span>
<span id="cb14-6"><a href="#cb14-6"></a></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="co"># impute with mode </span></span>
<span id="cb14-8"><a href="#cb14-8"></a>mode_cols <span class="op">=</span> [<span class="st">'STARS'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-22" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a><span class="cf">for</span> col <span class="kw">in</span> zero_cols:</span>
<span id="cb15-2"><a href="#cb15-2"></a>   X[col].fillna(<span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-3"><a href="#cb15-3"></a></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="cf">for</span> col <span class="kw">in</span> median_cols:</span>
<span id="cb15-5"><a href="#cb15-5"></a>   X[col].fillna(X[col].median(), inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-6"><a href="#cb15-6"></a>   </span>
<span id="cb15-7"><a href="#cb15-7"></a>X[<span class="st">'STARS'</span>].fillna(X[<span class="st">'STARS'</span>].mode()[<span class="dv">0</span>], inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-23" class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a>X.isna().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="78">
<pre><code>FixedAcidity          0
VolatileAcidity       0
CitricAcid            0
ResidualSugar         0
Chlorides             0
FreeSulfurDioxide     0
TotalSulfurDioxide    0
Density               0
pH                    0
Sulphates             0
Alcohol               0
LabelAppeal           0
AcidIndex             0
STARS                 0
dtype: int64</code></pre>
</div>
</div>
</section>
<section id="standard-scale" class="level3">
<h3 class="anchored" data-anchor-id="standard-scale">Standard Scale</h3>
<div id="cell-25" class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb18-2"><a href="#cb18-2"></a></span>
<span id="cb18-3"><a href="#cb18-3"></a>X_scaled <span class="op">=</span> scaler.fit_transform(X)</span>
<span id="cb18-4"><a href="#cb18-4"></a>X_preproc <span class="op">=</span> pd.DataFrame(X_scaled, columns<span class="op">=</span>X.columns)</span>
<span id="cb18-5"><a href="#cb18-5"></a></span>
<span id="cb18-6"><a href="#cb18-6"></a>X_preproc.describe().T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="79">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">FixedAcidity</td>
<td>12795.0</td>
<td>1.117598e-16</td>
<td>1.000039</td>
<td>-3.985141</td>
<td>-0.296913</td>
<td>-0.027815</td>
<td>0.383747</td>
<td>4.325244</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">VolatileAcidity</td>
<td>12795.0</td>
<td>3.887299e-18</td>
<td>1.000039</td>
<td>-3.972154</td>
<td>-0.247587</td>
<td>-0.056256</td>
<td>0.402937</td>
<td>4.280569</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">CitricAcid</td>
<td>12795.0</td>
<td>1.443854e-17</td>
<td>1.000039</td>
<td>-4.116268</td>
<td>-0.322967</td>
<td>0.001841</td>
<td>0.315050</td>
<td>4.119951</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ResidualSugar</td>
<td>12795.0</td>
<td>1.693752e-17</td>
<td>1.000039</td>
<td>-4.035627</td>
<td>-0.156555</td>
<td>-0.068532</td>
<td>0.295700</td>
<td>4.127726</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Chlorides</td>
<td>12795.0</td>
<td>6.663941e-18</td>
<td>1.000039</td>
<td>-3.937289</td>
<td>-0.167681</td>
<td>-0.026039</td>
<td>0.244368</td>
<td>4.181371</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">FreeSulfurDioxide</td>
<td>12795.0</td>
<td>-7.496934e-18</td>
<td>1.000039</td>
<td>-4.027964</td>
<td>-0.201891</td>
<td>-0.008864</td>
<td>0.239314</td>
<td>4.092961</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">TotalSulfurDioxide</td>
<td>12795.0</td>
<td>-2.721109e-17</td>
<td>1.000039</td>
<td>-4.124224</td>
<td>-0.498455</td>
<td>0.011969</td>
<td>0.368386</td>
<td>4.148162</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Density</td>
<td>12795.0</td>
<td>3.233122e-15</td>
<td>1.000039</td>
<td>-3.998729</td>
<td>-0.244293</td>
<td>0.010826</td>
<td>0.237871</td>
<td>3.958203</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">pH</td>
<td>12795.0</td>
<td>-4.198283e-16</td>
<td>1.000039</td>
<td>-4.076286</td>
<td>-0.354801</td>
<td>-0.011049</td>
<td>0.362594</td>
<td>4.368048</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Sulphates</td>
<td>12795.0</td>
<td>-3.942832e-17</td>
<td>1.000039</td>
<td>-4.007030</td>
<td>-0.530155</td>
<td>-0.008069</td>
<td>0.325178</td>
<td>4.179733</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Alcohol</td>
<td>12795.0</td>
<td>1.005144e-16</td>
<td>1.000039</td>
<td>-4.181551</td>
<td>-0.381313</td>
<td>-0.023320</td>
<td>0.472364</td>
<td>4.410292</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">LabelAppeal</td>
<td>12795.0</td>
<td>-2.110248e-17</td>
<td>1.000039</td>
<td>-2.234357</td>
<td>-1.112091</td>
<td>0.010175</td>
<td>1.132440</td>
<td>2.254706</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">AcidIndex</td>
<td>12795.0</td>
<td>-2.182441e-16</td>
<td>1.000039</td>
<td>-2.849759</td>
<td>-0.583683</td>
<td>0.171675</td>
<td>0.171675</td>
<td>6.969902</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">STARS</td>
<td>12795.0</td>
<td>3.887299e-17</td>
<td>1.000039</td>
<td>-1.329635</td>
<td>-0.039721</td>
<td>-0.039721</td>
<td>-0.039721</td>
<td>2.540107</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-26" class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X_preproc, y, test_size<span class="op">=</span><span class="fl">0.25</span>, random_state<span class="op">=</span><span class="dv">123</span>, shuffle<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="model-building" class="level2">
<h2 class="anchored" data-anchor-id="model-building">Model Building</h2>
<section id="support-vector-machine" class="level3">
<h3 class="anchored" data-anchor-id="support-vector-machine">Support Vector Machine</h3>
<div id="cell-29" class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a>svr <span class="op">=</span> SVR()</span>
<span id="cb20-2"><a href="#cb20-2"></a></span>
<span id="cb20-3"><a href="#cb20-3"></a>param_grid <span class="op">=</span> {</span>
<span id="cb20-4"><a href="#cb20-4"></a>   <span class="st">'kernel'</span>: [<span class="st">'linear'</span>, <span class="st">'poly'</span>, <span class="st">'rbf'</span>],</span>
<span id="cb20-5"><a href="#cb20-5"></a>   <span class="st">'C'</span>: [<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>],</span>
<span id="cb20-6"><a href="#cb20-6"></a>   <span class="st">'epsilon'</span>: [<span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>]</span>
<span id="cb20-7"><a href="#cb20-7"></a>}</span>
<span id="cb20-8"><a href="#cb20-8"></a></span>
<span id="cb20-9"><a href="#cb20-9"></a>grid_search <span class="op">=</span> GridSearchCV(estimator<span class="op">=</span>svr, param_grid<span class="op">=</span>param_grid, cv<span class="op">=</span><span class="dv">3</span>, scoring<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>) <span class="co"># complete: 2 mins</span></span>
<span id="cb20-10"><a href="#cb20-10"></a></span>
<span id="cb20-11"><a href="#cb20-11"></a>grid_search.fit(X_train, y_train)</span>
<span id="cb20-12"><a href="#cb20-12"></a></span>
<span id="cb20-13"><a href="#cb20-13"></a>best_svr_params <span class="op">=</span> grid_search.best_params_</span>
<span id="cb20-14"><a href="#cb20-14"></a>best_svr_model <span class="op">=</span> grid_search.best_estimator_</span>
<span id="cb20-15"><a href="#cb20-15"></a></span>
<span id="cb20-16"><a href="#cb20-16"></a><span class="bu">print</span>(<span class="st">"Best Parameters:"</span>, best_svr_params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>c:\Users\nickc\DataScience\NickAMC.github.io\ds_env\Lib\site-packages\sklearn\utils\validation.py:1183: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples, ), for example using ravel().
  y = column_or_1d(y, warn=True)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Best Parameters: {'C': 1, 'epsilon': 0.3, 'kernel': 'rbf'}</code></pre>
</div>
</div>
<div id="cell-30" class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a>svr_preds <span class="op">=</span> best_svr_model.predict(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="random-forest" class="level3">
<h3 class="anchored" data-anchor-id="random-forest">Random Forest</h3>
<div id="cell-32" class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1"></a>rf_param <span class="op">=</span> {</span>
<span id="cb24-2"><a href="#cb24-2"></a>    <span class="st">'n_estimators'</span>: [<span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>],</span>
<span id="cb24-3"><a href="#cb24-3"></a>    <span class="st">'max_depth'</span>: [<span class="dv">10</span>, <span class="dv">20</span>, <span class="va">None</span>],</span>
<span id="cb24-4"><a href="#cb24-4"></a>    <span class="st">'min_samples_split'</span>: [<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>],</span>
<span id="cb24-5"><a href="#cb24-5"></a>    <span class="st">'min_samples_leaf'</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>]</span>
<span id="cb24-6"><a href="#cb24-6"></a>}</span>
<span id="cb24-7"><a href="#cb24-7"></a></span>
<span id="cb24-8"><a href="#cb24-8"></a>rf <span class="op">=</span> RandomForestRegressor(random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb24-9"><a href="#cb24-9"></a></span>
<span id="cb24-10"><a href="#cb24-10"></a>rf_grid <span class="op">=</span> GridSearchCV(estimator<span class="op">=</span>rf, param_grid<span class="op">=</span>rf_param, cv<span class="op">=</span><span class="dv">3</span>, scoring<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>) <span class="co"># complete: 7mins </span></span>
<span id="cb24-11"><a href="#cb24-11"></a></span>
<span id="cb24-12"><a href="#cb24-12"></a>rf_grid.fit(X_train, y_train)</span>
<span id="cb24-13"><a href="#cb24-13"></a></span>
<span id="cb24-14"><a href="#cb24-14"></a>best_rf_params <span class="op">=</span> rf_grid.best_params_</span>
<span id="cb24-15"><a href="#cb24-15"></a>best_rf_model <span class="op">=</span> rf_grid.best_estimator_</span>
<span id="cb24-16"><a href="#cb24-16"></a></span>
<span id="cb24-17"><a href="#cb24-17"></a><span class="bu">print</span>(<span class="st">"Best Parameters:"</span>, best_rf_params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>c:\Users\nickc\DataScience\NickAMC.github.io\ds_env\Lib\site-packages\sklearn\base.py:1152: DataConversionWarning: A column-vector y was passed when a 1d array was expected. Please change the shape of y to (n_samples,), for example using ravel().
  return fit_method(estimator, *args, **kwargs)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Best Parameters: {'max_depth': 10, 'min_samples_leaf': 4, 'min_samples_split': 2, 'n_estimators': 200}</code></pre>
</div>
</div>
<p>Best Parameters: {‘max_depth’: 10, ‘min_samples_leaf’: 4, ‘min_samples_split’: 2, ‘n_estimators’: 200}</p>
<div id="cell-34" class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1"></a>rf_preds <span class="op">=</span> best_rf_model.predict(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="xgboost" class="level3">
<h3 class="anchored" data-anchor-id="xgboost">XGBoost</h3>
<div id="cell-36" class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb28-2"><a href="#cb28-2"></a>    <span class="st">'n_estimators'</span>: [<span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>],</span>
<span id="cb28-3"><a href="#cb28-3"></a>    <span class="st">'max_depth'</span>: [<span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">10</span>],</span>
<span id="cb28-4"><a href="#cb28-4"></a>    <span class="st">'learning_rate'</span>: [<span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span>],</span>
<span id="cb28-5"><a href="#cb28-5"></a>    <span class="st">'subsample'</span>: [<span class="fl">0.8</span>, <span class="fl">1.0</span>],</span>
<span id="cb28-6"><a href="#cb28-6"></a>    <span class="st">'colsample_bytree'</span>: [<span class="fl">0.8</span>, <span class="fl">1.0</span>],</span>
<span id="cb28-7"><a href="#cb28-7"></a>    <span class="st">'gamma'</span>: [<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>],</span>
<span id="cb28-8"><a href="#cb28-8"></a>    <span class="st">'reg_alpha'</span>: [<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>],</span>
<span id="cb28-9"><a href="#cb28-9"></a>    <span class="st">'reg_lambda'</span>: [<span class="dv">1</span>, <span class="fl">1.5</span>, <span class="dv">2</span>]</span>
<span id="cb28-10"><a href="#cb28-10"></a>}</span>
<span id="cb28-11"><a href="#cb28-11"></a></span>
<span id="cb28-12"><a href="#cb28-12"></a>xgb <span class="op">=</span> XGBRegressor(random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb28-13"><a href="#cb28-13"></a></span>
<span id="cb28-14"><a href="#cb28-14"></a>grid_search <span class="op">=</span> GridSearchCV(estimator<span class="op">=</span>xgb, param_grid<span class="op">=</span>param_grid, cv<span class="op">=</span><span class="dv">3</span>, scoring<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>) <span class="co"># complete: 14mins</span></span>
<span id="cb28-15"><a href="#cb28-15"></a></span>
<span id="cb28-16"><a href="#cb28-16"></a>grid_search.fit(X_train, y_train)</span>
<span id="cb28-17"><a href="#cb28-17"></a></span>
<span id="cb28-18"><a href="#cb28-18"></a>best_xgb_params <span class="op">=</span> grid_search.best_params_</span>
<span id="cb28-19"><a href="#cb28-19"></a>best_xgb_model <span class="op">=</span> grid_search.best_estimator_</span>
<span id="cb28-20"><a href="#cb28-20"></a></span>
<span id="cb28-21"><a href="#cb28-21"></a><span class="bu">print</span>(<span class="st">"Best Parameters:"</span>, best_xgb_params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Best Parameters: {'colsample_bytree': 0.8, 'gamma': 0.2, 'learning_rate': 0.1, 'max_depth': 3, 'n_estimators': 100, 'reg_alpha': 0.5, 'reg_lambda': 1.5, 'subsample': 1.0}</code></pre>
</div>
</div>
<div id="cell-37" class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1"></a>xgb_preds <span class="op">=</span> best_xgb_model.predict(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="simple-neural-network" class="level3">
<h3 class="anchored" data-anchor-id="simple-neural-network">Simple Neural Network</h3>
<div id="cell-39" class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1"></a><span class="im">import</span> torch</span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="im">import</span> torch</span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb31-4"><a href="#cb31-4"></a><span class="im">import</span> torch.optim <span class="im">as</span> optim</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-40" class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1"></a>X_train_tensor <span class="op">=</span> torch.tensor(X_train.values, dtype<span class="op">=</span>torch.float32)</span>
<span id="cb32-2"><a href="#cb32-2"></a>X_test_tensor <span class="op">=</span> torch.tensor(X_test.values, dtype<span class="op">=</span>torch.float32)</span>
<span id="cb32-3"><a href="#cb32-3"></a>y_train_tensor <span class="op">=</span> torch.tensor(y_train.values, dtype<span class="op">=</span>torch.float32).view(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb32-4"><a href="#cb32-4"></a>y_test_tensor <span class="op">=</span> torch.tensor(y_test.values, dtype<span class="op">=</span>torch.float32).view(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-41" class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1"></a><span class="kw">class</span> NeuralNetwork(nn.Module):</span>
<span id="cb33-2"><a href="#cb33-2"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, input_dim):</span>
<span id="cb33-3"><a href="#cb33-3"></a>        <span class="bu">super</span>(NeuralNetwork, <span class="va">self</span>).<span class="fu">__init__</span>()</span>
<span id="cb33-4"><a href="#cb33-4"></a>        <span class="va">self</span>.layer1 <span class="op">=</span> nn.Linear(input_dim, <span class="dv">64</span>)</span>
<span id="cb33-5"><a href="#cb33-5"></a>        <span class="va">self</span>.layer2 <span class="op">=</span> nn.Linear(<span class="dv">64</span>, <span class="dv">64</span>)</span>
<span id="cb33-6"><a href="#cb33-6"></a>        <span class="va">self</span>.layer3 <span class="op">=</span> nn.Linear(<span class="dv">64</span>, <span class="dv">1</span>)</span>
<span id="cb33-7"><a href="#cb33-7"></a>        <span class="va">self</span>.dropout <span class="op">=</span> nn.Dropout(<span class="fl">0.2</span>)</span>
<span id="cb33-8"><a href="#cb33-8"></a>        <span class="va">self</span>.relu <span class="op">=</span> nn.ReLU()</span>
<span id="cb33-9"><a href="#cb33-9"></a></span>
<span id="cb33-10"><a href="#cb33-10"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb33-11"><a href="#cb33-11"></a>        x <span class="op">=</span> <span class="va">self</span>.relu(<span class="va">self</span>.layer1(x))</span>
<span id="cb33-12"><a href="#cb33-12"></a>        x <span class="op">=</span> <span class="va">self</span>.dropout(x)</span>
<span id="cb33-13"><a href="#cb33-13"></a>        x <span class="op">=</span> <span class="va">self</span>.relu(<span class="va">self</span>.layer2(x))</span>
<span id="cb33-14"><a href="#cb33-14"></a>        x <span class="op">=</span> <span class="va">self</span>.dropout(x)</span>
<span id="cb33-15"><a href="#cb33-15"></a>        x <span class="op">=</span> <span class="va">self</span>.layer3(x)</span>
<span id="cb33-16"><a href="#cb33-16"></a>        <span class="cf">return</span> x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-42" class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1"></a>input_dim <span class="op">=</span> X_train_tensor.shape[<span class="dv">1</span>]</span>
<span id="cb34-2"><a href="#cb34-2"></a>model <span class="op">=</span> NeuralNetwork(input_dim)</span>
<span id="cb34-3"><a href="#cb34-3"></a>criterion <span class="op">=</span> nn.MSELoss()</span>
<span id="cb34-4"><a href="#cb34-4"></a>optimizer <span class="op">=</span> optim.Adam(model.parameters(), lr<span class="op">=</span><span class="fl">0.001</span>)</span>
<span id="cb34-5"><a href="#cb34-5"></a></span>
<span id="cb34-6"><a href="#cb34-6"></a>num_epochs <span class="op">=</span> <span class="dv">200</span></span>
<span id="cb34-7"><a href="#cb34-7"></a>batch_size <span class="op">=</span> <span class="dv">32</span></span>
<span id="cb34-8"><a href="#cb34-8"></a></span>
<span id="cb34-9"><a href="#cb34-9"></a>train_dataset <span class="op">=</span> torch.utils.data.TensorDataset(X_train_tensor, y_train_tensor)</span>
<span id="cb34-10"><a href="#cb34-10"></a>train_loader <span class="op">=</span> torch.utils.data.DataLoader(dataset<span class="op">=</span>train_dataset, batch_size<span class="op">=</span>batch_size, shuffle<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-43" class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1"></a><span class="cf">for</span> epoch <span class="kw">in</span> <span class="bu">range</span>(num_epochs):</span>
<span id="cb35-2"><a href="#cb35-2"></a>    model.train()</span>
<span id="cb35-3"><a href="#cb35-3"></a>    <span class="cf">for</span> i, (inputs, targets) <span class="kw">in</span> <span class="bu">enumerate</span>(train_loader):</span>
<span id="cb35-4"><a href="#cb35-4"></a>        outputs <span class="op">=</span> model(inputs)</span>
<span id="cb35-5"><a href="#cb35-5"></a>        loss <span class="op">=</span> criterion(outputs, targets)</span>
<span id="cb35-6"><a href="#cb35-6"></a>        </span>
<span id="cb35-7"><a href="#cb35-7"></a>        optimizer.zero_grad()</span>
<span id="cb35-8"><a href="#cb35-8"></a>        loss.backward()</span>
<span id="cb35-9"><a href="#cb35-9"></a>        optimizer.step()</span>
<span id="cb35-10"><a href="#cb35-10"></a>    </span>
<span id="cb35-11"><a href="#cb35-11"></a>    <span class="cf">if</span> (epoch<span class="op">+</span><span class="dv">1</span>) <span class="op">%</span> <span class="dv">10</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb35-12"><a href="#cb35-12"></a>        <span class="bu">print</span>(<span class="ss">f'Epoch [</span><span class="sc">{</span>epoch<span class="op">+</span><span class="dv">1</span><span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>num_epochs<span class="sc">}</span><span class="ss">], Loss: </span><span class="sc">{</span>loss<span class="sc">.</span>item()<span class="sc">:.4f}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch [10/200], Loss: 2.9414
Epoch [20/200], Loss: 1.9786
Epoch [30/200], Loss: 3.1680
Epoch [40/200], Loss: 2.6550
Epoch [50/200], Loss: 1.7019
Epoch [60/200], Loss: 2.3943
Epoch [70/200], Loss: 1.8342
Epoch [80/200], Loss: 2.6538
Epoch [90/200], Loss: 2.7670
Epoch [100/200], Loss: 2.0573
Epoch [110/200], Loss: 2.6068
Epoch [120/200], Loss: 1.6437
Epoch [130/200], Loss: 2.7924
Epoch [140/200], Loss: 2.1340
Epoch [150/200], Loss: 1.9290
Epoch [160/200], Loss: 1.9835
Epoch [170/200], Loss: 2.4833
Epoch [180/200], Loss: 2.5838
Epoch [190/200], Loss: 1.5983
Epoch [200/200], Loss: 2.4856</code></pre>
</div>
</div>
<div id="cell-44" class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1"></a>model.<span class="bu">eval</span>()</span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb37-3"><a href="#cb37-3"></a>    snn_preds <span class="op">=</span> model(X_test_tensor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="model-evaluation-and-selection" class="level2">
<h2 class="anchored" data-anchor-id="model-evaluation-and-selection">Model Evaluation and Selection</h2>
<div id="cell-46" class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1"></a><span class="co"># SVR metrics</span></span>
<span id="cb38-2"><a href="#cb38-2"></a>svr_mse <span class="op">=</span> mean_squared_error(y_test, svr_preds)</span>
<span id="cb38-3"><a href="#cb38-3"></a>svr_rmse <span class="op">=</span> svr_mse <span class="op">**</span> <span class="fl">0.5</span></span>
<span id="cb38-4"><a href="#cb38-4"></a>svr_mae <span class="op">=</span> mean_absolute_error(y_test,svr_preds)</span>
<span id="cb38-5"><a href="#cb38-5"></a></span>
<span id="cb38-6"><a href="#cb38-6"></a><span class="co"># rf metrics</span></span>
<span id="cb38-7"><a href="#cb38-7"></a>rf_mse <span class="op">=</span> mean_squared_error(y_test, rf_preds)</span>
<span id="cb38-8"><a href="#cb38-8"></a>rf_rmse <span class="op">=</span> rf_mse <span class="op">**</span> <span class="fl">0.5</span></span>
<span id="cb38-9"><a href="#cb38-9"></a>rf_mae <span class="op">=</span> mean_absolute_error(y_test, rf_preds)</span>
<span id="cb38-10"><a href="#cb38-10"></a><span class="co"># xgb metrics </span></span>
<span id="cb38-11"><a href="#cb38-11"></a></span>
<span id="cb38-12"><a href="#cb38-12"></a>xgb_mse <span class="op">=</span> mean_squared_error(y_test, xgb_preds)</span>
<span id="cb38-13"><a href="#cb38-13"></a>xgb_rmse <span class="op">=</span> xgb_mse <span class="op">**</span> <span class="fl">0.5</span></span>
<span id="cb38-14"><a href="#cb38-14"></a>xgb_mae <span class="op">=</span> mean_absolute_error(y_test, xgb_preds)</span>
<span id="cb38-15"><a href="#cb38-15"></a></span>
<span id="cb38-16"><a href="#cb38-16"></a><span class="co"># Simple Neural Network</span></span>
<span id="cb38-17"><a href="#cb38-17"></a>snn_mse <span class="op">=</span> mean_squared_error(y_test_tensor.numpy(), snn_preds.numpy())</span>
<span id="cb38-18"><a href="#cb38-18"></a>snn_rmse <span class="op">=</span> snn_mse <span class="op">**</span> <span class="fl">0.5</span></span>
<span id="cb38-19"><a href="#cb38-19"></a>snn_mae <span class="op">=</span> mean_absolute_error(y_test_tensor.numpy(), snn_preds.numpy())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-47" class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1"></a>metrics_data <span class="op">=</span> {</span>
<span id="cb39-2"><a href="#cb39-2"></a>    <span class="st">'Model'</span>: [<span class="st">'Support Vector Machine'</span>, <span class="st">'Random Forest'</span>, <span class="st">'XGBoost'</span>, <span class="st">'Simple Neural Network'</span>],</span>
<span id="cb39-3"><a href="#cb39-3"></a>    <span class="st">'MSE'</span>: [svr_mse, rf_mse, xgb_mse, snn_mse],</span>
<span id="cb39-4"><a href="#cb39-4"></a>    <span class="st">'RMSE'</span>: [svr_rmse, rf_rmse, xgb_rmse, snn_rmse],</span>
<span id="cb39-5"><a href="#cb39-5"></a>    <span class="st">'MAE'</span>: [svr_mae, rf_mae, xgb_mae, snn_mae]</span>
<span id="cb39-6"><a href="#cb39-6"></a>}</span>
<span id="cb39-7"><a href="#cb39-7"></a></span>
<span id="cb39-8"><a href="#cb39-8"></a>metrics_df <span class="op">=</span> pd.DataFrame(metrics_data)</span>
<span id="cb39-9"><a href="#cb39-9"></a></span>
<span id="cb39-10"><a href="#cb39-10"></a>metrics_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="94">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Model</th>
<th data-quarto-table-cell-role="th">MSE</th>
<th data-quarto-table-cell-role="th">RMSE</th>
<th data-quarto-table-cell-role="th">MAE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Support Vector Machine</td>
<td>2.658043</td>
<td>1.630351</td>
<td>1.208471</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Random Forest</td>
<td>2.281095</td>
<td>1.510329</td>
<td>1.181383</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>XGBoost</td>
<td>2.216882</td>
<td>1.488920</td>
<td>1.165807</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Simple Neural Network</td>
<td>2.573219</td>
<td>1.604126</td>
<td>1.239551</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-48" class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1"></a><span class="co"># rf feature importance</span></span>
<span id="cb40-2"><a href="#cb40-2"></a>rf_importances <span class="op">=</span> best_rf_model.feature_importances_</span>
<span id="cb40-3"><a href="#cb40-3"></a>rf_feature_importance <span class="op">=</span> pd.DataFrame({<span class="st">'Feature'</span>: X_train.columns, <span class="st">'Importance'</span>: rf_importances}).sort_values(by<span class="op">=</span><span class="st">'Importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb40-4"><a href="#cb40-4"></a></span>
<span id="cb40-5"><a href="#cb40-5"></a><span class="co"># xgb feature importance</span></span>
<span id="cb40-6"><a href="#cb40-6"></a>xgb_importances <span class="op">=</span> best_xgb_model.feature_importances_</span>
<span id="cb40-7"><a href="#cb40-7"></a>xgb_feature_importance <span class="op">=</span> pd.DataFrame({<span class="st">'Feature'</span>: X_train.columns, <span class="st">'Importance'</span>: xgb_importances}).sort_values(by<span class="op">=</span><span class="st">'Importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-49" class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1"></a>rf_feature_importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="96">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Feature</th>
<th data-quarto-table-cell-role="th">Importance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>STARS</td>
<td>0.379291</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>LabelAppeal</td>
<td>0.131541</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>AcidIndex</td>
<td>0.082383</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>TotalSulfurDioxide</td>
<td>0.051210</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Chlorides</td>
<td>0.046437</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>VolatileAcidity</td>
<td>0.045380</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>Density</td>
<td>0.038382</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>FreeSulfurDioxide</td>
<td>0.037885</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>pH</td>
<td>0.036243</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>CitricAcid</td>
<td>0.034267</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>Alcohol</td>
<td>0.032544</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>ResidualSugar</td>
<td>0.031140</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>Sulphates</td>
<td>0.027471</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>FixedAcidity</td>
<td>0.025826</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-50" class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1"></a>xgb_feature_importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="97">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Feature</th>
<th data-quarto-table-cell-role="th">Importance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>STARS</td>
<td>0.527032</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>AcidIndex</td>
<td>0.125381</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>LabelAppeal</td>
<td>0.111037</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>Chlorides</td>
<td>0.037516</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>TotalSulfurDioxide</td>
<td>0.037068</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>VolatileAcidity</td>
<td>0.030486</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>FreeSulfurDioxide</td>
<td>0.024638</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>CitricAcid</td>
<td>0.022089</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>ResidualSugar</td>
<td>0.021196</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Density</td>
<td>0.018723</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>pH</td>
<td>0.017992</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>Alcohol</td>
<td>0.012366</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>Sulphates</td>
<td>0.007681</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>FixedAcidity</td>
<td>0.006796</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>